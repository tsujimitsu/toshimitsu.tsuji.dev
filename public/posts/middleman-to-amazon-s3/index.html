<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.59.1" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="//fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
<link rel="stylesheet" href="/css/normalize.css">
<link rel="stylesheet" href="/css/skeleton.css">
<link rel="stylesheet" href="/css/custom.css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="tsuji.dev">
<title>Middleman to Amazon S3 - tsuji.dev</title>
</head>
<body>

<div class="container">

	<header role="banner">
		<div class="header-logo">
			<a href="/">tsuji.dev</a>
		</div>
		
	</header>

	<main role="main">
		<article itemscope itemtype="http://schema.org/BlogPosting">
			<h1 class="entry-title" itemprop="headline">Middleman to Amazon S3</h1>
			<span class="entry-meta"><time itemprop="datePublished" datetime="2014-11-23">November 23, 2014</time></span>
			<section itemprop="entry-text">
				

<h1 id="aws-にデプロイ用ユーザを作成">AWS にデプロイ用ユーザを作成</h1>

<ul>
<li>IAM(Identity and Access Management)でTravis CIからのデプロイ用ユーザ作成</li>
<li>デプロイ用ユーザにAmazon S3更新権限を付与（Attach User PolicyからAmazon S3 Full Access)</li>
</ul>

<h1 id="amazon-s3-にバケツ-公開用フォルダ-作成">Amazon S3 にバケツ（公開用フォルダ）作成</h1>

<ul>
<li>Amazon S3にバケツを作成。PropertiesからStatic Website HostingをEnable website hostingにする。</li>
<li>Index Documentにindex.htmlを指定</li>
</ul>

<h1 id="travis-ci-の設定">Travis CI の設定</h1>

<p>AWSデプロイ用ユーザ作成時のAccess Key IDを暗号化</p>

<pre><code class="language-yaml"># travis encrypt -r tsujimitsu/codelogue ***********
Please add the following to your .travis.yml file:

  secure: &quot;**********&quot;
</code></pre>

<p>同じ要領でSecret Access Keyも暗号化（-rの後ろはgithubのリポジトリを指定）</p>

<pre><code class="language-yaml">travis encrypt -r tsujimitsu/codelogue **********
Please add the following to your .travis.yml file:

  secure: &quot;**********&quot;
</code></pre>

<p>travis.ymlに追記</p>

<pre><code class="language-yaml">language: ruby
script: bundle exec middleman build &amp;&amp; ls -la ./build

deploy:
  provider: s3
  access_key_id:
    secure: &quot;GrfP2+eeRuTS/NS8ulOOC1Qe+rB2u52V/h2mE1CPWHquPHFtlKttyo3DLqEvWca9CtfLkWaiWxRSkcB74/GOiid+hh8HM+RRKL1/35L9rnQX1RdVIROxD81N5kLTybgwl9mymvc7RyBHyh6Tn/xIZMXkLyeyLUKvdcfRSlQAfBU=&quot;
  secret_access_key:
    secure: &quot;PYqKSxtAsO4COYENUX+Ofxvf82zhXehW81mX8aH8kALzstJ/eSCFPbLZQuebM8aiH3iBZtmllHe/4X7yXbJNBaxPnjtKeQcNufsyxADEqIitPO7vKOF7TDpV5z0UaDLb6h4ypjdhmOBY9rDKnzTJR8oreKRWOtpJCG/tDH9fwj4=&quot;
  bucket: www.codelogue.com
  region: tokyo
  endpoint: ***********************.amazonaws.com
  skip_cleanup: true
  local-dir: build/
  on:
    branch: master
</code></pre>

<p>skip_cleanupとlocal-dirが重要</p>

<h1 id="参考">参考</h1>

<ul>
<li><a href="http://bouzuya.hatenablog.com/entry/2014/05/20/193328">GitHub + Travis CI + Amazon S3 で git push で更新されるサイトをつくった</a></li>
<li><a href="http://docs.travis-ci.com/user/deployment/s3/">Travis - S3 Deployment</a></li>
<li><a href="http://please-sleep.cou929.nu/build-deploy-devlier-sphinx-doc-with-amazon-s3.html">Sphinx のドキュメントを Travis CI でビルドし S3 にデプロイ・配信する</a></li>
<li><a href="http://blog.katamari.co.jp/archives/260">S3 で静的ファイルなサイト立てるメモ</a></li>
</ul>

			</section>
		</article>
	</main>


	<footer role="contentinfo">
		<div class="hr"></div>
		<div class="footer-link">
			
			<a href="https://twitter.com/tsujimitsu" target="_blank">Twitter</a>
			<a href="https://www.facebook.com/tsujimitsu" target="_blank">Facebook</a>
			<a href="https://github.com/tsujimitsu/" target="_blank">GitHub</a>
			
		</div>
		<div class="copyright">Copyright &copy; tsujimitsu All rights reserved.</div>
	</footer>

</div>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
